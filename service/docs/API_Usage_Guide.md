# AIæ–‡æ¡£ç”Ÿæˆå™¨ API ä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡

é¦–å…ˆç¡®ä¿å®‰è£…äº†æ‰€æœ‰ä¾èµ–ï¼š

```bash
cd service
pip install -r requirements.txt
```

å¯åŠ¨RedisæœåŠ¡ï¼š
```bash
redis-server
```

å¯åŠ¨APIæœåŠ¡ï¼š
```bash
uvicorn api.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. å¥åº·æ£€æŸ¥

```bash
curl http://localhost:8000/
curl http://localhost:8000/api/v1/health
```

## ğŸ“‹ å®Œæ•´çš„å¤§çº²äº¤äº’æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰

å¦‚æœæœ‰ç›¸å…³æ–‡æ¡£éœ€è¦å‚è€ƒï¼Œå¯ä»¥å…ˆåˆ›å»ºä¸Šä¸‹æ–‡ï¼š

```bash
curl -X POST "http://localhost:8000/api/v1/contexts" \
  -H "Content-Type: application/json" \
  -d '{
    "files": [
      {
        "file_id": "doc-001",
        "file_name": "å‚è€ƒæ–‡æ¡£.pdf",
        "storage_url": "s3://bucket/reference.pdf"
      }
    ]
  }'
```

å“åº”ï¼š
```json
{
  "context_id": "ctx-abc123",
  "status": "PENDING"
}
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºä½œä¸š

åˆ›å»ºæ–‡æ¡£ç”Ÿæˆä½œä¸šï¼š

```bash
curl -X POST "http://localhost:8000/api/v1/jobs" \
  -H "Content-Type: application/json" \
  -d '{
    "context_id": "ctx-abc123",
    "task_prompt": "å†™ä¸€ä»½å…³äºæœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†çš„æ•™ç¨‹"
  }'
```

å“åº”ï¼š
```json
{
  "job_id": "job-xyz789",
  "status": "CREATED",
  "created_at": "2025-07-14T10:30:00Z"
}
```

### ç¬¬ä¸‰æ­¥ï¼šç”Ÿæˆå¤§çº²

è§¦å‘å¤§çº²ç”Ÿæˆï¼š

```bash
curl -X POST "http://localhost:8000/api/v1/jobs/job-xyz789/outline"
```

å“åº”ï¼š
```json
{
  "job_id": "job-xyz789",
  "outline_status": "GENERATING"
}
```

### ç¬¬å››æ­¥ï¼šè·å–å¤§çº²

ç­‰å¾…ç”Ÿæˆå®Œæˆåï¼Œè·å–å¤§çº²ï¼š

```bash
curl "http://localhost:8000/api/v1/jobs/job-xyz789/outline"
```

å“åº”ï¼š
```json
{
  "job_id": "job-xyz789",
  "outline_status": "READY",
  "outline": {
    "title": "å…³äº'å†™ä¸€ä»½å…³äºæœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†çš„æ•™ç¨‹'çš„æ–‡æ¡£",
    "nodes": [
      {
        "id": "node_1",
        "title": "æ¦‚è¿°ä¸èƒŒæ™¯",
        "content_summary": "ä»‹ç»å†™ä¸€ä»½å…³äºæœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†çš„æ•™ç¨‹çš„åŸºæœ¬æ¦‚å¿µå’Œé‡è¦æ€§",
        "children": []
      },
      {
        "id": "node_2",
        "title": "æ ¸å¿ƒå†…å®¹åˆ†æ",
        "content_summary": "æ·±å…¥åˆ†æå†™ä¸€ä»½å…³äºæœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†çš„æ•™ç¨‹çš„å…³é”®è¦ç´ ",
        "children": []
      },
      {
        "id": "node_3",
        "title": "åº”ç”¨ä¸å®è·µ",
        "content_summary": "æ¢è®¨å†™ä¸€ä»½å…³äºæœºå™¨å­¦ä¹ åŸºç¡€çŸ¥è¯†çš„æ•™ç¨‹çš„å®é™…åº”ç”¨åœºæ™¯",
        "children": []
      }
    ]
  }
}
```

### ç¬¬äº”æ­¥ï¼šæ›´æ–°å¤§çº²å¹¶å¼€å§‹æœ€ç»ˆç”Ÿæˆ

ç”¨æˆ·å¯ä»¥ä¿®æ”¹å¤§çº²ï¼Œç„¶åæäº¤ï¼š

```bash
curl -X PUT "http://localhost:8000/api/v1/jobs/job-xyz789/outline" \
  -H "Content-Type: application/json" \
  -d '{
    "outline": {
      "title": "æœºå™¨å­¦ä¹ åŸºç¡€æ•™ç¨‹ï¼ˆä¿®è®¢ç‰ˆï¼‰",
      "nodes": [
        {
          "id": "intro",
          "title": "æœºå™¨å­¦ä¹ å¯¼è®º",
          "content_summary": "ä»‹ç»æœºå™¨å­¦ä¹ çš„å®šä¹‰ã€å†å²å’Œåº”ç”¨",
          "children": []
        },
        {
          "id": "algorithms",
          "title": "æ ¸å¿ƒç®—æ³•è¯¦è§£",
          "content_summary": "è¯¦ç»†è®²è§£ä¸»è¦çš„æœºå™¨å­¦ä¹ ç®—æ³•",
          "children": []
        },
        {
          "id": "practice",
          "title": "å®æˆ˜æ¡ˆä¾‹åˆ†æ",
          "content_summary": "é€šè¿‡å®é™…æ¡ˆä¾‹å±•ç¤ºæœºå™¨å­¦ä¹ åº”ç”¨",
          "children": []
        }
      ]
    }
  }'
```

å“åº”ï¼š
```json
{
  "job_id": "job-xyz789",
  "message": "å¤§çº²æ›´æ–°æˆåŠŸï¼Œæœ€ç»ˆæ–‡æ¡£ç”Ÿæˆå·²å¼€å§‹"
}
```

## ğŸ”§ APIç«¯ç‚¹è¯¦è§£

### ä¸Šä¸‹æ–‡ç®¡ç†

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° | çŠ¶æ€ç  |
|------|------|-----|--------|
| `/api/v1/contexts` | POST | åˆ›å»ºæ–‡ä»¶ä¸Šä¸‹æ–‡ | 202 |

### ä½œä¸šç®¡ç†

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° | çŠ¶æ€ç  |
|------|------|-----|--------|
| `/api/v1/jobs` | POST | åˆ›å»ºæ–‡æ¡£ç”Ÿæˆä½œä¸š | 201 |

### å¤§çº²äº¤äº’

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° | çŠ¶æ€ç  |
|------|------|-----|--------|
| `/api/v1/jobs/{job_id}/outline` | POST | è§¦å‘å¤§çº²ç”Ÿæˆ | 202 |
| `/api/v1/jobs/{job_id}/outline` | GET | è·å–ç”Ÿæˆçš„å¤§çº² | 200 |
| `/api/v1/jobs/{job_id}/outline` | PUT | æ›´æ–°å¤§çº²å¹¶å¼€å§‹æœ€ç»ˆç”Ÿæˆ | 200 |

## ğŸ§ª è¿è¡Œæ¼”ç¤º

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„APIæ¼”ç¤ºè„šæœ¬ï¼š

```bash
python examples/api_demo.py
```

è¯¥è„šæœ¬ä¼šæ‰§è¡Œå®Œæ•´çš„æµç¨‹ï¼š
1. å¥åº·æ£€æŸ¥
2. åˆ›å»ºä¸Šä¸‹æ–‡
3. åˆ›å»ºä½œä¸š
4. ç”Ÿæˆå¤§çº²
5. ç­‰å¾…å®Œæˆ
6. ä¿®æ”¹å¤§çº²
7. è§¦å‘æœ€ç»ˆç”Ÿæˆ

## ğŸ§ª è¿è¡Œæµ‹è¯•

è¿è¡ŒAPIç«¯ç‚¹æµ‹è¯•ï¼š

```bash
cd tests
python test_api_endpoints.py
```

æˆ–ä½¿ç”¨pytestï¼š

```bash
pytest tests/test_api_endpoints.py -v
```

## ğŸ“Š çŠ¶æ€è¯´æ˜

### å¤§çº²çŠ¶æ€
- `PENDING`: å°šæœªå¼€å§‹ç”Ÿæˆ
- `GENERATING`: æ­£åœ¨ç”Ÿæˆä¸­
- `READY`: ç”Ÿæˆå®Œæˆ
- `FAILED`: ç”Ÿæˆå¤±è´¥

### ä½œä¸šçŠ¶æ€
- `CREATED`: ä½œä¸šå·²åˆ›å»º
- `processing`: æ­£åœ¨å¤„ç†ä¸­
- `completed`: å¤„ç†å®Œæˆ
- `failed`: å¤„ç†å¤±è´¥

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **RedisæœåŠ¡**: ç¡®ä¿RedisæœåŠ¡æ­£åœ¨è¿è¡Œï¼ŒAPIä¾èµ–Rediså­˜å‚¨çŠ¶æ€ä¿¡æ¯
2. **å¼‚æ­¥æ“ä½œ**: å¤§çº²ç”Ÿæˆå’Œæ–‡æ¡£ç”Ÿæˆéƒ½æ˜¯å¼‚æ­¥æ“ä½œï¼Œéœ€è¦è½®è¯¢çŠ¶æ€æˆ–ä½¿ç”¨äº‹ä»¶æµ
3. **é”™è¯¯å¤„ç†**: æ‰€æœ‰ç«¯ç‚¹éƒ½åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
4. **å¹¶å‘å®‰å…¨**: æ”¯æŒå¤šä¸ªä½œä¸šå¹¶å‘å¤„ç†

## ğŸš§ å¼€å‘è®¡åˆ’

æœªæ¥ç‰ˆæœ¬å°†æ”¯æŒï¼š
- [ ] Server-Sent Events (SSE) äº‹ä»¶æµ
- [ ] æ–‡æ¡£å†…å®¹æµå¼è¾“å‡º
- [ ] æ‰¹é‡ä½œä¸šå¤„ç†
- [ ] ä½œä¸šçŠ¶æ€æŸ¥è¯¢ç«¯ç‚¹
- [ ] ä¸Šä¸‹æ–‡çŠ¶æ€æŸ¥è¯¢ç«¯ç‚¹ 