# APIæµ‹è¯•æ–‡ä»¶è¯´æ˜

æœ¬ç›®å½•åŒ…å«äº†AIæ–‡æ¡£ç”Ÿæˆå™¨APIçš„å®Œæ•´æµ‹è¯•å·¥å…·é›†åˆã€‚

## ğŸ“ æ–‡ä»¶è¯´æ˜

### 1. `test_curl_commands.txt`
- **ç”¨é€”**: åŒ…å«æ‰€æœ‰APIç«¯ç‚¹çš„è¯¦ç»†curlå‘½ä»¤
- **ç‰¹ç‚¹**: æ¯ä¸ªå‘½ä»¤éƒ½æœ‰è¯¦ç»†æ³¨é‡Šå’Œç¤ºä¾‹
- **ä½¿ç”¨**: å¯ä»¥å¤åˆ¶ç²˜è´´å•ä¸ªå‘½ä»¤è¿›è¡Œæµ‹è¯•

### 2. `run_api_tests.sh`
- **ç”¨é€”**: å®Œæ•´çš„APIæµ‹è¯•è„šæœ¬
- **ç‰¹ç‚¹**: 
  - è‡ªåŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€
  - æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹
  - æ˜¾ç¤ºè¯¦ç»†çš„å“åº”ä¿¡æ¯
  - åŒ…å«çŠ¶æ€ç å’Œè€—æ—¶ç»Ÿè®¡
- **ä½¿ç”¨**: `./run_api_tests.sh`

### 3. `quick_test.sh`
- **ç”¨é€”**: å¿«é€ŸAPIæµ‹è¯•è„šæœ¬
- **ç‰¹ç‚¹**: 
  - å¿«é€ŸéªŒè¯æ ¸å¿ƒåŠŸèƒ½
  - ä½¿ç”¨jqæ ¼å¼åŒ–è¾“å‡º
  - é€‚åˆæ—¥å¸¸å¼€å‘æµ‹è¯•
- **ä½¿ç”¨**: `./quick_test.sh`

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å‰ç½®æ¡ä»¶
1. ç¡®ä¿æœåŠ¡å·²å¯åŠ¨: `./start_dev_server.sh`
2. ç¡®ä¿æœåŠ¡è¿è¡Œåœ¨: `http://localhost:8000`

### å¿«é€Ÿå¼€å§‹
```bash
# è¿›å…¥æµ‹è¯•ç›®å½•
cd test_case

# è¿è¡Œå¿«é€Ÿæµ‹è¯•
./quick_test.sh

# è¿è¡Œå®Œæ•´æµ‹è¯•
./run_api_tests.sh
```

## ğŸ“‹ APIç«¯ç‚¹åˆ—è¡¨

### 1. å¥åº·æ£€æŸ¥
- **ç«¯ç‚¹**: `GET /api/v1/health`
- **ç”¨é€”**: æ£€æŸ¥APIæœåŠ¡çŠ¶æ€
- **å“åº”**: `{"status": "healthy", "message": "APIæœåŠ¡è¿è¡Œæ­£å¸¸"}`

### 2. AIæ–‡æœ¬ç¼–è¾‘ (æµå¼å“åº”)
- **ç«¯ç‚¹**: `POST /api/v1/actions/edit`
- **ç”¨é€”**: æ–‡æœ¬æ¶¦è‰²ã€æ‰©å†™ã€æ€»ç»“ã€ç»­å†™ã€è‡ªå®šä¹‰ç¼–è¾‘
- **ç‰¹ç‚¹**: è¿”å›Server-Sent Eventsæ ¼å¼
- **æ”¯æŒæ“ä½œ**: `polish`, `expand`, `summarize`, `continue_writing`, `custom`

### 3. å¤§çº²ç”Ÿæˆ
- **ç«¯ç‚¹**: `POST /api/v1/jobs/outline`
- **ç”¨é€”**: æ ¹æ®ç”¨æˆ·æŒ‡ä»¤ç”Ÿæˆæ–‡æ¡£å¤§çº²
- **è¿”å›**: `taskId`, `sessionId`, `redisStreamKey`
- **ç‰¹ç‚¹**: æ”¯æŒåœ¨çº¿æœç´¢å’Œä¸Šä¸‹æ–‡æ–‡ä»¶

### 4. æ–‡æ¡£ç”Ÿæˆ (ä»å¤§çº²å¯¹è±¡)
- **ç«¯ç‚¹**: `POST /api/v1/jobs/document`
- **ç”¨é€”**: æ ¹æ®ç»“æ„åŒ–å¤§çº²å¯¹è±¡ç”Ÿæˆæ–‡æ¡£
- **è¾“å…¥**: å®Œæ•´çš„å¤§çº²å¯¹è±¡ç»“æ„

### 5. æ–‡æ¡£ç”Ÿæˆ (ä»å¤§çº²JSONå­—ç¬¦ä¸²)
- **ç«¯ç‚¹**: `POST /api/v1/jobs/document-from-outline`
- **ç”¨é€”**: æ ¹æ®å¤§çº²JSONå­—ç¬¦ä¸²ç”Ÿæˆæ–‡æ¡£
- **è¾“å…¥**: å¤§çº²çš„JSONåºåˆ—åŒ–å­—ç¬¦ä¸²

### 6. æ¨¡æ‹Ÿæ–‡æ¡£ç”Ÿæˆ
- **ç«¯ç‚¹**: `POST /api/v1/jobs/document-from-outline/mock`
- **ç”¨é€”**: æ¨¡æ‹Ÿæ–‡æ¡£ç”Ÿæˆè¿‡ç¨‹ï¼Œç«‹å³å¼€å§‹å‘å¸ƒRedisæµäº‹ä»¶
- **ç‰¹ç‚¹**: ç”¨äºæµ‹è¯•Redisæµäº‹ä»¶ç›‘å¬

### 7. æ ¹ç«¯ç‚¹
- **ç«¯ç‚¹**: `GET /`
- **ç”¨é€”**: åŸºç¡€æœåŠ¡ä¿¡æ¯
- **å“åº”**: æœåŠ¡åç§°ã€çŠ¶æ€ã€ç‰ˆæœ¬ä¿¡æ¯

## ğŸ”§ å“åº”æ ¼å¼

æ‰€æœ‰APIå“åº”éƒ½ä½¿ç”¨é©¼å³°å‘½åæ³• (camelCase):

```json
{
  "taskId": "1754537230406003516",
  "sessionId": "123456789",
  "redisStreamKey": "1754537230406003516",
  "status": "accepted",
  "message": "ä»»åŠ¡å·²æäº¤"
}
```

## ğŸ“¡ Redisæµäº‹ä»¶

å¤§çº²ç”Ÿæˆå’Œæ–‡æ¡£ç”Ÿæˆä»»åŠ¡ä¼šå‘å¸ƒäº‹ä»¶åˆ°Redisæµ:

- **æµåç§°**: ä½¿ç”¨`taskId`ä½œä¸ºæµåç§°
- **äº‹ä»¶æ ¼å¼**: JSONæ ¼å¼ï¼ŒåŒ…å«`redisId`, `eventType`, `taskType`ç­‰å­—æ®µ
- **ç›‘å¬å·¥å…·**: ä½¿ç”¨`test_mock_endpoint.py`ç›‘å¬æµäº‹ä»¶

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡æœªå¯åŠ¨**
   ```bash
   # å¯åŠ¨æœåŠ¡
   ./start_dev_server.sh
   ```

2. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£
   lsof -i :8000
   # åœæ­¢æœåŠ¡
   ./stop_dev_server.sh
   ```

3. **Redisè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥Redisé…ç½®
   ./config_redis.sh
   ```

4. **æƒé™é—®é¢˜**
   ```bash
   # æ·»åŠ æ‰§è¡Œæƒé™
   chmod +x *.sh
   ```

## ğŸ“ æµ‹è¯•å»ºè®®

1. **å¼€å‘é˜¶æ®µ**: ä½¿ç”¨`quick_test.sh`è¿›è¡Œå¿«é€ŸéªŒè¯
2. **é›†æˆæµ‹è¯•**: ä½¿ç”¨`run_api_tests.sh`è¿›è¡Œå®Œæ•´æµ‹è¯•
3. **æµäº‹ä»¶æµ‹è¯•**: ä½¿ç”¨`test_mock_endpoint.py`ç›‘å¬Redisäº‹ä»¶
4. **æ‰‹åŠ¨æµ‹è¯•**: ä½¿ç”¨`test_curl_commands.txt`ä¸­çš„å•ä¸ªå‘½ä»¤

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `../start_dev_server.sh`: å¯åŠ¨å¼€å‘æœåŠ¡å™¨
- `../test_mock_endpoint.py`: Redisæµäº‹ä»¶ç›‘å¬æµ‹è¯•
- `../service/api/endpoints.py`: APIç«¯ç‚¹å®šä¹‰
- `../service/src/doc_agent/schemas.py`: æ•°æ®æ¨¡å‹å®šä¹‰
