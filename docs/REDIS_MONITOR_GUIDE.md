# Redis æµæŒç»­ç›‘æ§å·¥å…·æŒ‡å—

## ğŸš€ æ¦‚è¿°

æä¾›äº†ä¸‰ä¸ªä¸åŒç‰ˆæœ¬çš„RedisæµæŒç»­ç›‘æ§è„šæœ¬ï¼Œæ”¯æŒå®æ—¶ç›‘æ§Redis Streamsç›´åˆ°æ‰‹åŠ¨åœæ­¢ã€‚

## ğŸ“‹ è„šæœ¬åˆ—è¡¨

### 1. `simple_redis_monitor.sh` - ç®€åŒ–ç‰ˆShellè„šæœ¬
**ç‰¹ç‚¹**: ç®€å•æ˜“ç”¨ï¼ŒåŸºç¡€åŠŸèƒ½å®Œæ•´
**é€‚ç”¨**: å¿«é€Ÿç›‘æ§å•ä¸ªæµ

### 2. `continuous_redis_monitor.sh` - å®Œæ•´ç‰ˆShellè„šæœ¬  
**ç‰¹ç‚¹**: åŠŸèƒ½ä¸°å¯Œï¼Œæ”¯æŒå¤šç§é€‰é¡¹
**é€‚ç”¨**: éœ€è¦é«˜çº§åŠŸèƒ½çš„ç”¨æˆ·

### 3. `redis_stream_monitor.py` - Pythonç‰ˆæœ¬
**ç‰¹ç‚¹**: åŠŸèƒ½æœ€å¼ºå¤§ï¼Œæ”¯æŒJSONè§£æå’Œç¾åŒ–è¾“å‡º
**é€‚ç”¨**: éœ€è¦è¯¦ç»†åˆ†æå’Œè°ƒè¯•

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### ç®€åŒ–ç‰ˆShellè„šæœ¬

```bash
# ç›‘æ§é»˜è®¤ä»»åŠ¡
./simple_redis_monitor.sh

# ç›‘æ§æŒ‡å®šä»»åŠ¡
./simple_redis_monitor.sh my_job_123

# æ˜¾ç¤ºå¸®åŠ©
./simple_redis_monitor.sh -h
```

### å®Œæ•´ç‰ˆShellè„šæœ¬

```bash
# ç›‘æ§é»˜è®¤ä»»åŠ¡
./continuous_redis_monitor.sh

# ç›‘æ§æŒ‡å®šä»»åŠ¡
./continuous_redis_monitor.sh my_job_123

# ç›‘æ§æ‰€æœ‰æµ
./continuous_redis_monitor.sh -a

# ä½¿ç”¨ç¾åŒ–è¾“å‡º
./continuous_redis_monitor.sh -p my_job_123

# è®¾ç½®è¶…æ—¶å’Œæ¶ˆæ¯æ•°
./continuous_redis_monitor.sh -t 10000 -c 20 my_job_123

# æ˜¾ç¤ºå¸®åŠ©
./continuous_redis_monitor.sh -h
```

### Pythonç‰ˆæœ¬

```bash
# ç›‘æ§é»˜è®¤ä»»åŠ¡
python3 redis_stream_monitor.py

# ç›‘æ§æŒ‡å®šä»»åŠ¡
python3 redis_stream_monitor.py my_job_123

# ç›‘æ§æ‰€æœ‰æµ
python3 redis_stream_monitor.py -a

# ä½¿ç”¨ç¾åŒ–è¾“å‡º
python3 redis_stream_monitor.py -p my_job_123

# è®¾ç½®è¶…æ—¶æ—¶é—´
python3 redis_stream_monitor.py -t 10000 my_job_123

# è‡ªå®šä¹‰Redisè¿æ¥
python3 redis_stream_monitor.py --host 192.168.1.100 --port 6379 --password mypassword my_job_123

# æ˜¾ç¤ºå¸®åŠ©
python3 redis_stream_monitor.py -h
```

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | Shellç®€åŒ–ç‰ˆ | Shellå®Œæ•´ç‰ˆ | Pythonç‰ˆ |
|------|-------------|-------------|----------|
| åŸºç¡€ç›‘æ§ | âœ… | âœ… | âœ… |
| å¤šæµç›‘æ§ | âŒ | âœ… | âœ… |
| ç¾åŒ–è¾“å‡º | âŒ | âœ… | âœ… |
| JSONè§£æ | âŒ | âŒ | âœ… |
| å‚æ•°é…ç½® | åŸºç¡€ | å®Œæ•´ | å®Œæ•´ |
| é”™è¯¯å¤„ç† | åŸºç¡€ | å®Œæ•´ | å®Œæ•´ |
| å¿ƒè·³æ˜¾ç¤º | âœ… | âœ… | âœ… |
| ä¼˜é›…åœæ­¢ | âœ… | âœ… | âœ… |

## ğŸ¯ æ¨èä½¿ç”¨åœºæ™¯

### ä½¿ç”¨Shellç®€åŒ–ç‰ˆå½“ï¼š
- å¿«é€Ÿæµ‹è¯•å•ä¸ªæµ
- åªéœ€è¦åŸºç¡€ç›‘æ§åŠŸèƒ½
- ç³»ç»Ÿèµ„æºæœ‰é™

### ä½¿ç”¨Shellå®Œæ•´ç‰ˆå½“ï¼š
- éœ€è¦ç›‘æ§å¤šä¸ªæµ
- éœ€è¦è‡ªå®šä¹‰è¶…æ—¶å’Œæ¶ˆæ¯æ•°
- éœ€è¦ç¾åŒ–è¾“å‡º

### ä½¿ç”¨Pythonç‰ˆå½“ï¼š
- éœ€è¦è¯¦ç»†åˆ†ææ¶ˆæ¯å†…å®¹
- éœ€è¦JSONæ•°æ®è§£æ
- éœ€è¦è‡ªå®šä¹‰Redisè¿æ¥å‚æ•°
- éœ€è¦æœ€å®Œæ•´çš„é”™è¯¯å¤„ç†

## ğŸ” ç›‘æ§ç¤ºä¾‹

### 1. å¯åŠ¨ç›‘æ§
```bash
# ä½¿ç”¨Pythonç‰ˆæœ¬ç›‘æ§æŒ‡å®šä»»åŠ¡
python3 redis_stream_monitor.py my_job_123
```

### 2. æäº¤æµ‹è¯•ä»»åŠ¡
```bash
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æäº¤ä»»åŠ¡
curl -X POST "http://localhost:8000/api/v1/jobs/outline" \
  -H "Content-Type: application/json" \
  -d '{
    "sessionId": "my_job_123",
    "taskPrompt": "è¯·ä¸ºæˆ‘ç”Ÿæˆä¸€ä»½å…³äºäººå·¥æ™ºèƒ½çš„è¯¦ç»†å¤§çº²",
    "isOnline": true,
    "contextFiles": []
  }'
```

### 3. è§‚å¯Ÿè¾“å‡º
```
ğŸš€ Redis æµæŒç»­ç›‘æ§å·¥å…·
==================================================
æœåŠ¡å™¨: 10.215.149.74:26379
ä»»åŠ¡ID: my_job_123
æµ: job_events:my_job_123
è¶…æ—¶: 5000ms
è¾“å‡ºæ ¼å¼: ç¾åŒ–

ğŸ” æ£€æŸ¥Redisè¿æ¥...
âœ… Redisè¿æ¥æ­£å¸¸
âš ï¸  æµ job_events:my_job_123 ä¸å­˜åœ¨æˆ–ä¸ºç©º
ğŸ’¡ ç­‰å¾…æ–°æ¶ˆæ¯...

ğŸ” å¼€å§‹ç›‘æ§æµ: job_events:my_job_123
æŒ‰ Ctrl+C åœæ­¢ç›‘æ§

============================================================
ğŸ“¨ æ–°æ¶ˆæ¯
æµ: job_events:my_job_123
ID: 1703123456789-0
æ—¶é—´: 2023-12-21 15:30:45

äº‹ä»¶ç±»å‹: task_started
æ•°æ®:
{
  "job_id": "my_job_123",
  "status": "started",
  "timestamp": "2023-12-21T15:30:45Z"
}
============================================================
```

## ğŸ›‘ åœæ­¢ç›‘æ§

æ‰€æœ‰è„šæœ¬éƒ½æ”¯æŒä½¿ç”¨ `Ctrl+C` ä¼˜é›…åœæ­¢ï¼š

```
ğŸ›‘ æ­£åœ¨åœæ­¢ç›‘æ§...
âœ… ç›‘æ§å·²åœæ­¢
```

## ğŸ”§ é…ç½®è¯´æ˜

### Redisè¿æ¥é…ç½®
æ‰€æœ‰è„šæœ¬éƒ½ä½¿ç”¨ä»¥ä¸‹é»˜è®¤é…ç½®ï¼š
- **ä¸»æœº**: 10.215.149.74
- **ç«¯å£**: 26379
- **å¯†ç **: xJrhp*4mnHxbBWN2grqq
- **æ•°æ®åº“**: 0

### è¶…æ—¶è®¾ç½®
- **é»˜è®¤è¶…æ—¶**: 5000ms (5ç§’)
- **å»ºè®®èŒƒå›´**: 1000-30000ms
- **è¶…æ—¶è¿‡é•¿**: å“åº”æ…¢ï¼Œä½†å‡å°‘ç½‘ç»œè¯·æ±‚
- **è¶…æ—¶è¿‡çŸ­**: å“åº”å¿«ï¼Œä½†å¢åŠ ç½‘ç»œè¯·æ±‚

### æ¶ˆæ¯æ•°é‡
- **é»˜è®¤æ•°é‡**: 10æ¡
- **å»ºè®®èŒƒå›´**: 1-100æ¡
- **æ•°é‡è¿‡å¤§**: å¯èƒ½ä¸¢å¤±æ¶ˆæ¯
- **æ•°é‡è¿‡å°**: å¤„ç†é¢‘ç¹

## ğŸ› æ•…éšœæ’é™¤

### 1. è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥RedisæœåŠ¡
redis-cli -h 10.215.149.74 -p 26379 -a "xJrhp*4mnHxbBWN2grqq" ping

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping 10.215.149.74
```

### 2. æ²¡æœ‰æ¶ˆæ¯
```bash
# æ£€æŸ¥æµæ˜¯å¦å­˜åœ¨
redis-cli -h 10.215.149.74 -p 26379 -a "xJrhp*4mnHxbBWN2grqq" KEYS "job_events:*"

# æ£€æŸ¥æµé•¿åº¦
redis-cli -h 10.215.149.74 -p 26379 -a "xJrhp*4mnHxbBWN2grqq" XLEN "job_events:my_job_123"
```

### 3. æƒé™é—®é¢˜
```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x *.sh

# æ£€æŸ¥Pythonä¾èµ–
pip install redis
```

## ğŸ“ æ—¥å¿—è®°å½•

æ‰€æœ‰è„šæœ¬éƒ½ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºç›‘æ§ä¿¡æ¯ï¼Œå»ºè®®é‡å®šå‘åˆ°æ–‡ä»¶ï¼š

```bash
# ä¿å­˜ç›‘æ§æ—¥å¿—
python3 redis_stream_monitor.py my_job_123 > monitor.log 2>&1

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f monitor.log
```

## ğŸ”„ æŒç»­ç›‘æ§

å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨ `nohup` æˆ– `screen` è¿›è¡Œåå°ç›‘æ§ï¼š

```bash
# åå°è¿è¡Œ
nohup python3 redis_stream_monitor.py my_job_123 > monitor.log 2>&1 &

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep redis_stream_monitor

# åœæ­¢ç›‘æ§
kill <PID>
``` 