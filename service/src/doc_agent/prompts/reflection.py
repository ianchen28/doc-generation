# service/src/doc_agent/prompts/reflection.py
"""
Reflection 节点的提示词模板

用于智能查询扩展，分析现有数据和查询，生成更精确的搜索查询
"""

V1_DEFAULT = """
你是一个专业的研究专家和查询优化师。请分析现有的搜索查询和已收集的数据，生成更精确、更相关的搜索查询。

**文档主题:** {topic}

**当前章节信息:**
- 章节标题: {chapter_title}
- 章节描述: {chapter_description}

**原始搜索查询:**
{original_queries}

**已收集的数据摘要:**
{gathered_data_summary}

**任务要求:**
1. 仔细分析已收集的数据，识别信息缺口、模糊之处或新的有趣方向
2. 考虑原始查询的覆盖范围和深度
3. 生成2-3个新的、高度相关的、更具体的或探索性的搜索查询
4. 新查询应该：
   - 填补信息缺口
   - 深入特定方面
   - 探索新的角度或视角
   - 使用更精确的关键词

**输出格式:**
请以JSON格式返回结果，包含以下字段：
- new_queries: 新的搜索查询列表（数组，2-3个查询）
- reasoning: 简要说明为什么需要这些新查询

请立即开始分析并生成新的查询。
"""

V1_ANALYTICAL = """
你是一个高级研究分析师和查询优化专家。请基于深度分析现有数据和查询，生成更精确、更有针对性的搜索查询。

**文档主题:** {topic}

**当前章节信息:**
- 章节标题: {chapter_title}
- 章节描述: {chapter_description}

**原始搜索查询:**
{original_queries}

**已收集的数据摘要:**
{gathered_data_summary}

**分析要求:**
1. 深度分析已收集数据的质量和覆盖范围
2. 识别数据中的关键信息、趋势和模式
3. 发现信息缺口、矛盾之处或需要进一步验证的观点
4. 考虑原始查询的有效性和局限性

**新查询生成策略:**
- 针对数据中的具体案例或实例进行深入查询
- 探索与主题相关的争议性或最新发展
- 寻找不同观点或对比分析的机会
- 关注数据中提到的但未充分展开的子主题

**输出格式:**
请以JSON格式返回结果，包含以下字段：
- new_queries: 新的搜索查询列表（数组，2-3个查询）
- reasoning: 详细说明分析过程和为什么需要这些新查询
- data_insights: 从现有数据中发现的关键洞察

请立即开始深度分析并生成新的查询。
"""

V1_EXPLORATORY = """
你是一个创新研究专家和查询探索师。请基于现有数据发现新的研究方向和探索机会，生成创新性的搜索查询。

**文档主题:** {topic}

**当前章节信息:**
- 章节标题: {chapter_title}
- 章节描述: {chapter_description}

**原始搜索查询:**
{original_queries}

**已收集的数据摘要:**
{gathered_data_summary}

**探索要求:**
1. 分析现有数据中隐藏的模式和趋势
2. 识别与主题相关但尚未充分探索的新角度
3. 发现跨领域或跨学科的联系机会
4. 寻找创新性、前瞻性的研究方向

**创新查询策略:**
- 探索主题与其他领域的交叉点
- 寻找最新的技术、方法或理论发展
- 关注新兴趋势和未来发展方向
- 发现数据中暗示但未明确提及的新方向

**输出格式:**
请以JSON格式返回结果，包含以下字段：
- new_queries: 新的搜索查询列表（数组，2-3个查询）
- reasoning: 详细说明探索过程和创新思路
- exploration_insights: 从探索中发现的新视角和机会

请立即开始探索性分析并生成新的查询。
"""

# 简化版本的 reflection prompt
V2_FAST = """
你是一个专业的研究专家和查询优化师。请快速分析现有的搜索查询和已收集的数据，生成更精确的搜索查询。

**文档主题:** {topic}
**当前章节:** {chapter_title}
**章节描述:** {chapter_description}

**原始搜索查询:**
{original_queries}

**已收集的数据摘要:**
{gathered_data_summary}

**任务要求:**
1. 快速分析已收集的数据，识别主要信息缺口
2. 生成2个新的、更具体的搜索查询
3. 新查询应该针对当前章节的核心内容

**输出格式:**
请严格按照以下 JSON 格式输出，不要包含任何其他内容：

{{
    "new_queries": ["新查询1", "新查询2"],
    "reasoning": "简要说明为什么需要这些新查询"
}}

要求：
1. new_queries 应该包含2个具体的搜索查询
2. reasoning 应该简要说明查询的目的
3. 必须严格按照 JSON 格式输出，确保 JSON 格式正确
4. 搜索查询应该使用通用关键词，确保能在知识库中找到相关内容
"""

# 支持版本选择的PROMPTS字典
PROMPTS = {
    "v1_default": V1_DEFAULT,
    "v1_analytical": V1_ANALYTICAL,
    "v1_exploratory": V1_EXPLORATORY,
    "v2_fast": V2_FAST
}
